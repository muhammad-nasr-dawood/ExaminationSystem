@model ExaminationSystem.MVC.ViewModels.DepartmentViewModels.AddEditDeptViewModel

<div class="modal fade" id="editDepartmentModal-@Model.Id" tabindex="-1" aria-labelledby="editDepartmentModalLabel-@Model.Id" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editDepartmentModalLabel-@Model.Id">
					@if (Model.Id == 0)
					{
						<text>Add New Department</text>
					}
					else
					{
						<text>Edit Department - @Model.Name</text>
					}
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form id="editDepartmentForm" method="post" asp-action="@((Model.Id == 0) ? "Add" : "Edit")" asp-route-id="@Model.Id">
					<input type="hidden" name="Id" value="@Model.Id" />

					<div class="mb-3">
						<label asp-for="Name" class="form-label"></label>
						<input asp-for="Name" class="form-control" maxlength="" />
						<span asp-validation-for="Name" class="text-danger"></span>
					</div>

					<div class="mb-3">
						<label asp-for="Disc" class="form-label" ></label>
						<input asp-for="Disc" class="form-control" maxlength="" />
						<span asp-validation-for="Disc" class="text-danger"></span>

					</div>



					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">
							@(Model.Id == 0 ? "Add Department" : "Save Changes")
						</button>
					</div>

				</form>
			</div>
		</div>
	</div>
</div>

<script>

		$(document).ready(function () {
			$('#editDepartmentForm').on('submit', function (e) {
				e.preventDefault();
				   if (!$(this).valid()) {
					   return;
	               }

				var formData = $(this).serialize();

				$.ajax({
					type: 'POST',
					url: $(this).attr('action'),
					data: formData,
					success: function (response) {
						if (response.success) {
							console.log(response);
							$('#editDepartmentModal-' + (response.id ?? 0)).modal('hide');

							if (response.id != 0) {
								
								$('#department-' + response.id + ' .fw-bold').text(response.department.name);
								$('#department-' + response.id + ' .text-muted strong:first').text(response.department.disc);
								$('#department-' + response.id + ' .text-muted strong:last').text(response.department.capacity);
							} else {
								
								var newDeptHtml = `
								<div class="col-lg-4 col-md-6" id="department-${response.department.id}">
									<div class="card shadow-lg border-0 rounded-3 h-100 position-relative">
										<div class="card-body p-4 d-flex flex-column justify-content-between">

											<div class="dropdown position-absolute top-0 end-0 m-3">
												<button class="btn btn-icon" type="button" data-bs-toggle="dropdown" aria-expanded="false">
													<i class="ti ti-dots-vertical"></i>
												</button>
												<ul class="dropdown-menu">
													<li>
														<a class="dropdown-item text-warning edit-department-btn" href="javascript:void(0);" data-id="${response.department.id}">
															<i class="ti ti-pencil me-2"></i>Edit
														</a>
													</li>
													<li>
														<a class="dropdown-item text-danger delete-department-btn" href="javascript:void(0);" data-id="${response.department.id}">
															<i class="ti ti-trash me-2"></i>Delete
														</a>
													</li>
												</ul>
											</div>

											<div>
												<h5 class="fw-bold text-primary mb-2">${response.department.name}</h5>
												<p class="text-muted mb-2">Description: <strong>${response.department.disc}</strong></p>
												<p class="text-muted mb-2">Capacity: <strong>${response.department.capacity}</strong></p>
											</div>

											<div class="d-flex gap-2">
												<a href="/Branches/ShowStudents?deptId=${response.department.id}&branchId=${response.branchId}" class="btn btn-primary btn-sm w-50">
													Show Students
												</a>
												<a href="/Departments/ShowCourses?id=${response.department.id}" class="btn btn-secondary btn-sm w-50">
													Show Courses
												</a>
											</div>

											<div class="mt-3">
												<span class="badge px-3 py-2 rounded-pill bg-success text-white">Active</span>
											</div>

										</div>
									</div>
								</div>`;
								$('#department-list').append(newDeptHtml);
							}

						} else {
							alert('Error: ' + response.message);
						}
					},
					error: function () {
						alert('An error occurred while saving the department.');
					}
				});
			});
		});
</script>


