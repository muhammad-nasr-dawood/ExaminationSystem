@model IEnumerable<ExaminationSystem.MVC.ViewModels.StaffViewModels.StaffAddViewModel>

@* @{ *@
@*     ViewData["Title"] = "GetAllStaff"; *@
@* } *@

@{
	ViewData["Title"] = "Staff List - Pages";
}

@section VendorStyles {
	<link rel="stylesheet" href="~/vendor/libs/datatables-bs5/datatables.bootstrap5.css">
	<link rel="stylesheet" href="~/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css">
	<link rel="stylesheet" href="~/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css">
	<link rel="stylesheet" href="~/vendor/libs/select2/select2.css" />
	<link rel="stylesheet" href="~/vendor/libs/&#64;form-validation/form-validation.css" />
	<link rel="stylesheet" href="~/vendor/libs/bs-stepper/bs-stepper.css" />
	<link rel="stylesheet" href="~/vendor/libs/bootstrap-select/bootstrap-select.css" />
	<link rel="stylesheet" href="~/vendor/libs/animate-css/animate.css">
}

@section VendorScripts {
	<script src="~/vendor/libs/moment/moment.js"></script>
	<script src="~/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script> 
	<script src="~/vendor/libs/select2/select2.js"></script>
	<script src="~/vendor/libs/&#64;form-validation/popular.js"></script>
	<script src="~/vendor/libs/&#64;form-validation/bootstrap5.js"></script>
	<script src="~/vendor/libs/&#64;form-validation/auto-focus.js"></script>
	<script src="~/vendor/libs/cleavejs/cleave.js"></script>
	<script src="~/vendor/libs/cleavejs/cleave-phone.js"></script>
	<script src="~/vendor/libs/bs-stepper/bs-stepper.js"></script>
	<script src="~/vendor/libs/bootstrap-select/bootstrap-select.js"></script>
	<script src="~/vendor/libs/select2/select2.js"></script>
	<script src="~/vendor/libs/&#64;form-validation/popular.js"></script>
	<script src="~/vendor/libs/&#64;form-validation/bootstrap5.js"></script>
	<script src="~/vendor/libs/&#64;form-validation/auto-focus.js"></script>
}


@* ************** Content ************** *@

<div class="row g-6 mb-6">
	<div class="col-sm-6 col-xl-3">
		<div class="card">
			<div class="card-body">
				<div class="d-flex align-items-start justify-content-between">
					<div class="content-left">
						<span class="text-heading">Session</span>
						<div class="d-flex align-items-center my-1">
							<h4 class="mb-0 me-2">21,459</h4>
							<p class="text-success mb-0">(+29%)</p>
						</div>
						<small class="mb-0">Total Users</small>
					</div>
					<div class="avatar">
						<span class="avatar-initial rounded bg-label-primary">
							<i class="ti ti-users ti-26px"></i>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-6 col-xl-3">
		<div class="card">
			<div class="card-body">
				<div class="d-flex align-items-start justify-content-between">
					<div class="content-left">
						<span class="text-heading">Paid Users</span>
						<div class="d-flex align-items-center my-1">
							<h4 class="mb-0 me-2">4,567</h4>
							<p class="text-success mb-0">(+18%)</p>
						</div>
						<small class="mb-0">Last week analytics </small>
					</div>
					<div class="avatar">
						<span class="avatar-initial rounded bg-label-danger">
							<i class="ti ti-user-plus ti-26px"></i>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-6 col-xl-3">
		<div class="card">
			<div class="card-body">
				<div class="d-flex align-items-start justify-content-between">
					<div class="content-left">
						<span class="text-heading">Active Users</span>
						<div class="d-flex align-items-center my-1">
							<h4 class="mb-0 me-2">19,860</h4>
							<p class="text-danger mb-0">(-14%)</p>
						</div>
						<small class="mb-0">Last week analytics</small>
					</div>
					<div class="avatar">
						<span class="avatar-initial rounded bg-label-success">
							<i class="ti ti-user-check ti-26px"></i>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-6 col-xl-3">
		<div class="card">
			<div class="card-body">
				<div class="d-flex align-items-start justify-content-between">
					<div class="content-left">
						<span class="text-heading">Pending Users</span>
						<div class="d-flex align-items-center my-1">
							<h4 class="mb-0 me-2">237</h4>
							<p class="text-success mb-0">(+42%)</p>
						</div>
						<small class="mb-0">Last week analytics</small>
					</div>
					<div class="avatar">
						<span class="avatar-initial rounded bg-label-warning">
							<i class="ti ti-user-search ti-26px"></i>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Users List Table -->
<div class="card">
	<div class="card-header border-bottom">
		<h5 class="card-title mb-0">Filters</h5>
		<div class="d-flex justify-content-between align-items-center row pt-4 gap-4 gap-md-0">
			<div class="col-md-4 user_role"></div>
      <div class="col-md-4 user_plan"></div>
      <div class="col-md-4 user_status"></div>
			<div class="col-md-3">
				<select id="branchFilter" class="form-select">
					<option value="">Filter by Branch</option>
					@* @foreach (var branch in ViewBag.Branches) *@
					@* { *@
					@* 	<option value="@branch.Id">@branch.Name</option> *@
					@* } *@
				</select>
			</div>
			<div class="col-md-3">
				<select id="departmentFilter" class="form-select">
					<option value="">Filter by Department</option> 
					@* @foreach (var dept in ViewBag.Departments) *@
					@* { *@
					@* 	<option value="@dept.Id">@dept.Name</option> *@
					@* } *@
				</select>
			</div>
			<div class="col-md-3">
				<select id="statusFilter" class="form-select">
					<option value="">Filter by Status</option>
					<option value="true">Active</option>
					<option value="false">In Active</option>
				</select>
			</div>
			<div class="col-md-3">
			  <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#largeModal">
				  Add Staff
			  </button>
			</div>
		</div>
		<div class="table-responsive text-nowrap">
			<table id="staffTable" class="table table-hover">
				<thead>
					<tr>
						<th>Staff</th>
						<th>Ssn</th>
						<th>Salary</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody class="table-border-bottom-0">
						
				</tbody>

					@* @foreach (var item in Model) *@
					@* { *@
					@* 	<tr> *@
					@* 		<td> *@
					@* 			<ul class="list-unstyled m-0 avatar-group d-flex align-items-center"> *@
					@* 				<li data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" class="avatar avatar-xs pull-up" title="Christina Parker"> *@
					@* 					<img src="@item.ImageURL" alt="Avatar" class="rounded-circle"> *@
					@* 					<span>@item.FullName</span> *@
					@* 				</li> *@
					@* 			</ul> *@
					@* 		</td> *@
					@* 		<td>@item.Ssn</td> *@
					@* 		<td> *@
					@* 			@item.Salary *@
					@* 		</td> *@
					@* 		<td><span class="badge bg-label-primary me-1">Active</span></td> *@
					@* 		<td> *@
					@* 			<div class="dropdown"> *@
					@* 				<button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="ti ti-dots-vertical"></i></button> *@
					@* 				<div class="dropdown-menu"> *@
					@* 					<a class="dropdown-item" href="javascript:void(0);"><i class="ti ti-pencil me-1"></i> Edit</a> *@
					@* 					<a class="dropdown-item" href="javascript:void(0);"><i class="ti ti-trash me-1"></i> Delete</a> *@
					@* 				</div> *@
					@* 			</div> *@
					@* 		</td> *@
					@* 	</tr> *@
					@* } *@
			</table>
		</div>
	</div>
	<!-- Offcanvas to add new user -->
</div>

<!-- Validation Wizard -->
<!-- Large Modal -->
<div class="modal fade" id="largeModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel3">Modal title</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<!-- my de7k from here--->
			<div class="col-12 mb-6"  >
				@* <small class="text-light fw-medium">Validation</small> *@
					<div id="wizard-validation" class="bs-stepper mt-2">
					<div class="bs-stepper-header">
						<div class="step" data-target="#account-details-validation">
							<button type="button" class="step-trigger">
								<span class="bs-stepper-circle">1</span>
								<span class="bs-stepper-label mt-1">
									<span class="bs-stepper-title">Account Details</span>
									<span class="bs-stepper-subtitle">Setup Account Details</span>
								</span>
							</button>
						</div>
						<div class="line">
							<i class="ti ti-chevron-right"></i>
						</div>
						<div class="step" data-target="#personal-info-validation">
							<button type="button" class="step-trigger">
								<span class="bs-stepper-circle">2</span>
								<span class="bs-stepper-label">
									<span class="bs-stepper-title">Personal Info</span>
									<span class="bs-stepper-subtitle">Add personal info</span>
								</span>
							</button>
						</div>
						<div class="line">
							<i class="ti ti-chevron-right"></i>
						</div>
						<div class="step" data-target="#social-links-validation">
							<button type="button" class="step-trigger">
								<span class="bs-stepper-circle">3</span>
								<span class="bs-stepper-label">
									<span class="bs-stepper-title">Social Links</span>
									<span class="bs-stepper-subtitle">Add social links</span>
								</span>
							</button>
						</div>
					</div>
					<div class="bs-stepper-content">
						<form id="wizard-validation-form" onSubmit="return false">
							<!-- Account Details -->
							<div id="account-details-validation" class="content">
								<div class="content-header mb-4">
									<h6 class="mb-0">Account Details</h6>
									<small>Enter Your Account Details.</small>
								</div>
								<div class="row g-6">
									<div class="col-sm-6">
										<label class="form-label" for="formValidationUsername">Username</label>
										<input type="text" name="formValidationUsername" id="formValidationUsername" class="form-control" placeholder="johndoe" />
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationEmail">Email</label>
										<input type="email" name="formValidationEmail" id="formValidationEmail" class="form-control" placeholder="john.doe@email.com" aria-label="john.doe" />
									</div>
									<div class="col-sm-6 form-password-toggle">
										<label class="form-label" for="formValidationPass">Password</label>
										<div class="input-group input-group-merge">
											<input type="password" id="formValidationPass" name="formValidationPass" class="form-control" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="formValidationPass2" />
											<span class="input-group-text cursor-pointer" id="formValidationPass2"><i class="ti ti-eye-off"></i></span>
										</div>
									</div>
									<div class="col-sm-6 form-password-toggle">
										<label class="form-label" for="formValidationConfirmPass">Confirm Password</label>
										<div class="input-group input-group-merge">
											<input type="password" id="formValidationConfirmPass" name="formValidationConfirmPass" class="form-control" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="formValidationConfirmPass2" />
											<span class="input-group-text cursor-pointer" id="formValidationConfirmPass2"><i class="ti ti-eye-off"></i></span>
										</div>
									</div>
									<div class="col-12 d-flex justify-content-between">
										<button class="btn btn-label-secondary btn-prev" disabled>
											<i class="ti ti-arrow-left ti-xs me-sm-2 me-0"></i>
											<span class="align-middle d-sm-inline-block d-none">Previous</span>
										</button>
										<button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-2">Next</span> <i class="ti ti-arrow-right ti-xs"></i></button>
									</div>
								</div>
							</div>
							<!-- Personal Info -->
							<div id="personal-info-validation" class="content">
								<div class="content-header mb-4">
									<h6 class="mb-0">Personal Info</h6>
									<small>Enter Your Personal Info.</small>
								</div>
								<div class="row g-6">
									<div class="col-sm-6">
										<label class="form-label" for="formValidationFirstName">First Name</label>
										<input type="text" id="formValidationFirstName" name="formValidationFirstName" class="form-control" placeholder="John" />
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationLastName">Last Name</label>
										<input type="text" id="formValidationLastName" name="formValidationLastName" class="form-control" placeholder="Doe" />
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationCountry">Country</label>
										<select class="select2" id="formValidationCountry" name="formValidationCountry">
											<option label=" "></option>
											<option>UK</option>
											<option>USA</option>
											<option>Spain</option>
											<option>France</option>
											<option>Italy</option>
											<option>Australia</option>
										</select>
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationLanguage">Language</label>
										<select class="selectpicker w-auto" id="formValidationLanguage" data-style="btn-transparent" data-icon-base="ti" data-tick-icon="ti-check text-white" name="formValidationLanguage" multiple>
											<option>English</option>
											<option>French</option>
											<option>Spanish</option>
										</select>
									</div>
									<div class="col-12 d-flex justify-content-between">
										<button class="btn btn-label-secondary btn-prev">
											<i class="ti ti-arrow-left ti-xs me-sm-2 me-0"></i>
											<span class="align-middle d-sm-inline-block d-none">Previous</span>
										</button>
										<button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-2">Next</span> <i class="ti ti-arrow-right ti-xs"></i></button>
									</div>
								</div>
							</div>
							<!-- Social Links -->
							<div id="social-links-validation" class="content">
								<div class="content-header mb-4">
									<h6 class="mb-0">Social Links</h6>
									<small>Enter Your Social Links.</small>
								</div>
								<div class="row g-6">
									<div class="col-sm-6">
										<label class="form-label" for="formValidationTwitter">Twitter</label>
										<input type="text" name="formValidationTwitter" id="formValidationTwitter" class="form-control" placeholder="https://twitter.com/abc" />
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationFacebook">Facebook</label>
										<input type="text" name="formValidationFacebook" id="formValidationFacebook" class="form-control" placeholder="https://facebook.com/abc" />
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationGoogle">Google+</label>
										<input type="text" name="formValidationGoogle" id="formValidationGoogle" class="form-control" placeholder="https://plus.google.com/abc" />
									</div>
									<div class="col-sm-6">
										<label class="form-label" for="formValidationLinkedIn">LinkedIn</label>
										<input type="text" name="formValidationLinkedIn" id="formValidationLinkedIn" class="form-control" placeholder="https://linkedin.com/abc" />
									</div>
									<div class="col-12 d-flex justify-content-between">
										<button class="btn btn-label-secondary btn-prev">
											<i class="ti ti-arrow-left ti-xs me-sm-2 me-0"></i>
											<span class="align-middle d-sm-inline-block d-none">Previous</span>
										</button>
										<button class="btn btn-success btn-next btn-submit">Submit</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
			<!-- /Validation Wizard -->
			@* <div class="modal-footer"> *@
			@* 	<button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Close</button> *@
			@* 	<button type="button" class="btn btn-primary">Save changes</button> *@
			@* </div> *@
			</div>
	</div>
</div>


@section PageScripts {
	
	<script src="~/js/app-user-list.js"></script>
	<script src="~/js/form-wizard-numbered.js"></script>
	<script src="~/js/form-wizard-validation.js"></script>
	<script src="~/js/ui-modals.js"></script>
<script>
    $(document).ready(function () {
        var table = $('#staffTable').DataTable({
            processing: true,
            serverSide: true,
            ajax: {
                url: '/Staff/GetAllStaff',
                type: 'POST',
                data: function (d) {
                    d.branchId = $('#branchFilter').val();
                    d.DeptId = $('#departmentFilter').val();
					d.statusFilter = $('#statusFilter').val();
                },
				dataSrc: function (json) {
					if (!json.data || json.data.length === 0) {
						console.log("No data returned from server.");
					} else {
						console.log("Returned data:", json.data);
					}
					return json.data;
				}
				},
            columns: [
                { 
                    data: null,
                    render: function(data) {
                        return `
                            <ul class="list-unstyled m-0 avatar-group d-flex align-items-center">
                                <li data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" 
                                    class="avatar avatar-xs pull-up" title="${data.fullName}">
                                    <img src="${data.imageURL}" alt="Avatar" class="rounded-circle">
                                    <span>${data.fullName}</span>
                                </li>
                            </ul>`;
                    }
                },
                { data: 'ssn' },
                { data: 'salary' },
                { 
                    data: null,
                    render: function(data) {
						if(data.isActive == true)
						  return '<span class="badge bg-label-primary me-1">Active</span>';
						else
							  return '<span class="badge bg-label-danger me-1">Inactive</span>'
                    }
                },
                // {
                //     data: null,
                //     render: function(data) {
                //         return `
                //             <div class="dropdown">
                //                 <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                //                     <i class="ti ti-dots-vertical"></i>
                //                 </button>
                //                 <div class="dropdown-menu">
                //                     <a class="dropdown-item" href="/Staff/Edit/${data.Ssn}">
                //                         <i class="ti ti-pencil me-1"></i> Edit
                //                     </a>
                //                     <a class="dropdown-item" href="javascript:void(0);" onclick="confirmDelete('${data.Ssn}')">
                //                         <i class="ti ti-trash me-1"></i> Delete
                //                     </a>
                //                 </div>
                //             </div>`;
                //     }
                // }
            ],
            language: {
                paginate: {
                    previous: '<span aria-hidden="true">⟨</span>',
                    next: '<span aria-hidden="true">⟩</span>'
                }
            }
        });

        $('#searchTerm').on('input', function () {
            table.search($(this).val()).draw();
        });

			$('#branchFilter, #departmentFilter, #statusFilter').change(function () {
            table.draw();
        });
    });

    function confirmDelete(staffId) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/Staff/Delete/${staffId}`,
                    type: 'POST',
                    success: function (response) {
                        if (response.success) {
                            $('#staffTable').DataTable().ajax.reload();
                            Swal.fire(
                                'Deleted!',
                                'Staff member has been deleted.',
                                'success'
                            );
                        } else {
                            Swal.fire(
                                'Error!',
                                response.message || 'Failed to delete staff member.',
                                'error'
                            );
                        }
                    },
                    error: function () {
                        Swal.fire(
                            'Error!',
                            'An error occurred while deleting the staff member.',
                            'error'
                        );
                    }
                });
            }
        });
    }
</script>
}
